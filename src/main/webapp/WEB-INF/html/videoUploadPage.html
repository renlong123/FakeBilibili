<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <base href="${#request.getContextPath()+'/'}"/>
    <link rel="stylesheet"  th:href="@{/static/bootstrap/css/bootstrap.css }"/>
    <script type="text/javascript"  th:src="@{/static/bootstrap/jquery-3.2.1.min.js}"></script>
    <script type="text/javascript"  th:src="@{/static/bootstrap/js/bootstrap.min.js}"></script>
    <!--<link rel="icon" th：href="@{/static/img/favicon.ico}"/>-->
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}" />
    <title>视频上传</title>
</head>
<body>
<div th:include="header :: header"></div>

<div class="container">
    <div class="row">
        <div class="col-md-11">
            <form class="form-horizontal" th:action="@{/uploadVideo}" method="POST">
               <!-- <div class="form-group">
                    <label for="inputuserId" class="col-sm-2 control-label">用户ID</label>
                    <div class="col-sm-10">
                        <input type="text" name="id" class="form-control" id="inputuserId" th:value="${session.userInfo.id}">
                    </div>
                    &lt;!&ndash;<span  th:text="${session.fieldError}"></span>&ndash;&gt;
                </div>-->
                <!--<div class="form-group">
                    <label for="inputuserpic" class="col-sm-2 control-label">头像</label>
                    <div class="col-sm-10">
                        <input type="image" name="name" class="form-control" id="inputuserpic" th:src="${session.userInfo.name}">
                    </div>
                    &lt;!&ndash; <span  th:text="${session.fieldError}"></span>&ndash;&gt;
                </div>-->
                <div class="form-group">
                    <label for="inputvideoname" class="col-sm-2 control-label">名称</label>
                    <div class="col-sm-10">
                        <input type="text" name="name" class="form-control" id="inputvideoname">
                    </div>
                    <!-- <span  th:text="${session.fieldError}"></span>-->
                </div>
                <div class="form-group">
                    <label for="inputdescription" class="col-sm-2 control-label">简介</label>
                    <div class="col-sm-10">
                        <input type="text" name="description" class="form-control" id="inputdescription" >
                        <!--th:value="${session.userInfo.name}"-->
                    </div>
                    <!--<span  th:text="${session.fieldError}"></span>-->
                </div>
                <div class="form-group">
                    <label for="inputCategory" class="col-sm-2 control-label">分类</label>
                    <div class="col-sm-10">
                        <select class="form-control" name="categoryId" id="inputCategory">
                        </select>
                        <button id="myAddCategory" type="button" class="btn btn-primary">增加分类</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="uploadVideoCover" class="col-sm-2 control-label">选择视频封面</label>
                    <div class="col-sm-10">
                        <input type="file" id="uploadVideoCover" name="vedioCoverPic">
                        <img >
                        <p class="help-block">请选择视频封面</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="uploadVideo" class="col-sm-2 control-label">选择视频</label>
                    <div class="col-sm-10">
                        <input type="file" id="uploadVideo" name="videoAttr">
                        <img >
                        <p class="help-block">请选择上传的视频</p>
                    </div>
                </div>
                <div class="form-group">
                    <!--<div class="col-sm-offset-2 col-sm-4">
                        <button type="button" class="btn btn-success btn-block" onclick="loginButtonActive()">登录</button>
                    </div>-->
                    <div class="col-sm-offset-2 col-sm-4">
                        <button type="submit" class="btn btn-warning btn-block">上传</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="addCategoryModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">添加新分类</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="newCategoryName">分类名</label>
                        <input type="text" id="newCategoryName" name="name">
                    </div>
                    <div class="form-group">
                        <label for="newCategoryDes">描述</label>
                        <input type="text" id="newCategoryDes" name="description">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="addCategoryConfirm">增加</button>
                </div>
            </form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script th:inline="javascript">
    $(function () {
        var createTime = [[${session.userInfo.lastLoginin}]];
        var date = new Date(createTime);
        var datetring1 = date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();
        //alert(datetring1);
        $("#inputLoginNum").val(datetring1);
        /* th:value="${#dates.format(${session.userInfo.lastLoginin},'yyyy-MM-dd')}"*/


        $("#myAddCategory").click(function () {
            $('#addCategoryModal').modal('show');
        });

        function updateSelection(){

        }

        $("#addCategoryConfirm").click(function () {
            var path = [[${#request.getContextPath()}]];
            $.ajax({
                url: path+"/addCategory",
                data:{
                    name: $("#newCategoryName").val(),
                    description:$("#newCategoryDes").val()
                },
                type: "POST",
                dataType: "json",
                success: function (data) {
                    $('#addCategoryModal').modal('hide');
                    // //alert(data);
                    // var obj = $.parseJSON(data);
                    // //alert(obj[0].name);
                    // //var obj = JSON.parse(data);
                    // alert(obj);
                    $("#inputCategory").empty();
                    $("#inputCategory").prepend("<option value='0'>请选择</option>");
                    /*if (data.categories.length > 0) {*/
                        //alert(data.categories[0].id);
                        $.each(data.categories,function (i,item) {
                            $("#inputCategory").append("<option value='" + item.id + "'>" + item.name + "</option>");
                        })
                        /*for (var i = 0; i < data.categories.length; i++) {
                            $("#inputCategory").append("<option value='" + data.categories[i].id + "'>" + data.categories[i].name + "</option>");
                        }*/
                    /*}*/
                },
                error:function () {
                    alert("插入分类失败");
                }
            });
        });
    });

</script>

<div th:include="footer :: footer"></div>
</body>
</html>